<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recruitment Applications Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #000000;
      color: #e0e0e0;
      padding: 30px;
    }
    .main-container {
      max-width: 800px;
      margin: 0 auto;
      overflow-x: hidden;
    }
    .card {
      background-color: #1a1a1a;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.8);
      border: 1px solid #333333;
    }
    .form-label {
      font-weight: 600;
      color: #bb86fc;
    }
    .form-control {
      background-color: #2a2a2a;
      color: #ffffff;
      border: 2px solid #555555;
    }
    .form-control:focus {
      background-color: #3a3a3a;
      border-color: #bb86fc;
      box-shadow: 0 0 0 0.2rem rgba(187, 134, 252, 0.25);
      color: #ffffff;
    }
    .form-select {
      background-color: #2a2a2a;
      color: #ffffff;
      border: 2px solid #555555;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e");
    }
    .form-select:focus {
      background-color: #3a3a3a;
      border-color: #bb86fc;
      box-shadow: 0 0 0 0.2rem rgba(187, 134, 252, 0.25);
      color: #ffffff;
    }
    .controls button {
      min-width: 120px;
      min-height: 44px; /* Minimum touch target size */
    }
    .controls {
      margin-top: 12px;
    }
    .nav-buttons {
      gap: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    /* Section spacing helpers */
    .section-gap {
      margin-top: 8px;
      margin-bottom: 10px;
    }
    .save-row {
      margin-top: 4px; /* tightened spacing above save button */
      margin-bottom: 14px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    h1 {
      color: #bb86fc;
      text-align: center;
      margin-bottom: 25px;
    }
    #searchInput {
      max-width: 400px;
      margin: 15px auto;
      display: block;
      background-color: #2a2a2a !important;
      border: 2px solid #555555 !important;
      color: #ffffff !important;
    }
    #searchInput:focus {
      background-color: #3a3a3a !important;
      border-color: #bb86fc !important;
      box-shadow: 0 0 0 0.2rem rgba(187, 134, 252, 0.25) !important;
    }
    #searchInput::placeholder {
      color: #aaaaaa !important;
    }
    .footer {
      text-align: center;
      color: #888;
      margin-top: 18px;
      font-size: 0.98rem;
      letter-spacing: 0.5px;
    }
    .header-container {
      position: relative;
      margin-bottom: 20px;
      text-align: center;
      padding-top: 20px;
      padding-bottom: 8px;
    }
    .logo {
      display: block;
      margin: 0 auto 12px auto;
      width: 96px;
      height: auto;
      object-fit: contain;
    }
    .mic-gradient {
      background: linear-gradient(45deg, #f25022 0%, #7fba00 25%, #00a4ef 50%, #ffb900 75%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Tablet and medium screens */
    @media (max-width: 992px) and (min-width: 769px) {
      body {
        padding: 25px;
      }
      .main-container {
        padding: 25px 20px;
      }
      h1 {
        font-size: 1.8rem;
      }
      .logo {
        width: 80px;
      }
      .controls button {
        min-width: 100px;
      }
    }
    
    /* Mobile and Tablet Responsive Styles */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      .main-container {
        padding: 20px 15px;
      }
      .header-container {
        padding-left: 20px;
        padding-top: 10px;
      }
      h1 {
        font-size: 1.6rem;
        margin-bottom: 10px;
      }
      .logo {
        width: 72px;
      }
      .card {
        padding: 15px;
      }
      .controls {
        flex-direction: row !important;
        gap: 10px;
        width: 100%;
      }
      .nav-buttons {
        width: 100%;
        justify-content: space-between;
        gap: 10px;
      }
      .controls button {
        min-width: auto;
        flex: 1;
        font-size: 0.9rem;
        padding: 10px 8px;
      }
      .d-flex.gap-3 {
        flex-direction: column;
        gap: 15px;
      }
      .form-control, .form-select {
        font-size: 16px; /* Prevents zoom on iOS */
      }
      #fileInput, #searchInput, #filterSelect {
        max-width: 100%;
      }
      /* Improve file picker layout on mobile */
      #dropzone {
        flex-direction: column;
        gap: 10px;
        padding: 15px;
        text-align: center;
      }
      #dropzone > div:first-child {
        flex-direction: column;
        gap: 8px;
      }
      #chooseFileBtn {
        min-width: auto;
        width: 100%;
      }
      /* Download buttons mobile layout */
      .save-row .d-flex {
        flex-direction: column;
        gap: 10px;
        width: 100%;
      }
      .save-row .btn {
        width: 100%;
        min-width: auto;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      .main-container {
        padding: 12px 8px;
      }
      h1 {
        font-size: 1.4rem;
        line-height: 1.3;
      }
      .header-container {
        padding-left: 8px;
      }
      .logo {
        width: 56px;
      }
      .card {
        padding: 12px;
        margin-bottom: 15px;
      }
      .form-label {
        font-size: 0.95rem;
      }
      .btn {
        font-size: 0.85rem;
        padding: 8px 10px;
      }
      .footer {
        text-align: center;
        margin-top: 14px;
        font-size: 0.9rem;
      }
      #filterStatusText {
        font-size: 0.95rem;
      }
      /* Extra small screens - ensure no horizontal overflow */
      .d-flex.gap-3 {
        margin-left: -4px;
        margin-right: -4px;
      }
      .d-flex.gap-3 > .card {
        margin-left: 4px;
        margin-right: 4px;
      }
      /* Better button spacing */
      .controls button {
        font-size: 0.85rem;
        padding: 8px 6px;
      }
      /* Ensure proper spacing for save button on mobile */
      #saveBtn {
        margin-top: 20px !important;
        margin-bottom: 20px !important;
      }
      /* Improve dropzone on very small screens */
      #dropzone {
        padding: 12px 8px;
      }
    }
    
    /* Toast Notification Styles */
    .toast-container {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1050;
    }
    
    .toast {
      background-color: #2a2a2a;
      color: #ffffff;
      border: 1px solid #555555;
      border-radius: 8px;
      padding: 12px 20px;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.7);
      opacity: 0;
      transform: translateY(100px);
      transition: all 0.3s ease-in-out;
      min-width: 300px;
      text-align: center;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .toast.success {
      border-left: 4px solid #28a745;
      background: linear-gradient(135deg, #28a745, #20c997);
    }
    
    .toast.error {
      border-left: 4px solid #dc3545;
      background: linear-gradient(135deg, #dc3545, #e74c3c);
    }
    
    .toast.info {
      border-left: 4px solid #bb86fc;
      background: linear-gradient(135deg, #bb86fc, #9c4dcc);
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      backdrop-filter: blur(5px);
    }
    
    .modal-content {
      background-color: #1a1a1a;
      margin: 5% auto;
      padding: 30px;
      border: 1px solid #333333;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 8px 32px rgba(0,0,0,0.9);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #333333;
    }
    
    .modal-title {
      color: #bb86fc;
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }
    
    .close {
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .close:hover {
      color: #bb86fc;
    }
    
    .help-button {
      position: absolute;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #bb86fc, #9c4dcc);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(187, 134, 252, 0.3);
      transition: all 0.3s ease;
    }
    
    .patch-button {
      position: absolute;
      top: 20px;
      right: 150px;
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
      transition: all 0.3s ease;
    }
    
    .analytics-button {
      position: absolute;
      top: 20px;
      right: 280px;
      background: linear-gradient(135deg, #4fc3f7, #29b6f6);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(79, 195, 247, 0.3);
      transition: all 0.3s ease;
    }
    
    .help-button:hover, .patch-button:hover, .analytics-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(187, 134, 252, 0.4);
    }
    
    .patch-button:hover {
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
    }
    
    .analytics-button:hover {
      box-shadow: 0 4px 12px rgba(79, 195, 247, 0.4);
    }
    
    .instruction-section {
      margin-bottom: 20px;
    }
    
    .instruction-section h3 {
      color: #bb86fc;
      font-size: 1.1rem;
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .instruction-section ul {
      color: #e0e0e0;
      padding-left: 20px;
    }
    
    .instruction-section li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    
    .keyboard-shortcut {
      background-color: #333333;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.9em;
      color: #bb86fc;
    }
    
    /* Mobile adjustments for modal */
    @media (max-width: 768px) {
      .modal-content {
        margin: 10% auto;
        padding: 20px;
        width: 95%;
      }
      
      .help-button {
        top: 10px;
        right: 10px;
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      
      .patch-button {
        top: 50px;
        right: 10px;
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      
      .analytics-button {
        top: 90px;
        right: 10px;
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      
      .toast {
        min-width: 280px;
        margin: 0 10px;
      }
    }
  </style>
    </head>
    <body>
      <div class="main-container">
          <button id="helpBtn" class="help-button">❓ How to Use</button>
          <button id="patchBtn" class="patch-button">📋 Patch Notes</button>
          <button id="analyticsBtn" class="analytics-button">📊 Analytics</button>
          <div class="header-container">
            <img src="logo.png" alt="Logo" class="logo" />
            <h1>
              <span class="mic-gradient">MIC Recruitments</span> 
              <span style="color:#bb86fc;">25-26 Application Viewer</span>
            </h1>
          </div>
          <!-- Elegant file picker: styled button + dropzone -->
          <div id="filePicker" class="mb-3" style="max-width:100%;margin:0 auto;">
            <div id="dropzone" class="d-flex align-items-center justify-content-between" style="border:2px dashed #666666;border-radius:10px;padding:12px 14px;background:#222222;"> 
              <div style="display:flex;gap:12px;align-items:center;">
                <button id="chooseFileBtn" class="btn btn-outline-primary" style="min-width:140px;">Choose file</button>
                <div id="fileName" style="color:#cccccc;word-break:break-all;">No file selected</div>
              </div>
              <div>
                <button id="clearFileBtn" class="btn btn-sm btn-light" style="display:none;">Clear</button>
              </div>
            </div>
            <input type="file" id="fileInput" accept=".xlsx,.xls" style="display:none;" />
          </div>
          <input type="text" id="searchInput" class="form-control" placeholder="🔍 Search by keyword or 'tags:tagname'..." />

          <div class="mb-3 d-flex justify-content-center gap-2">
            <select id="filterSelect" class="form-select" style="max-width:220px;">
              <option value="all">Show All</option>
              <option value="approved">Show Approved</option>
              <option value="rejected">Show Rejected</option>
            </select>
          </div>

          <!-- Filter status text -->
          <div class="text-center mb-3">
            <span id="filterStatusText" style="color:#bb86fc;font-weight:600;font-size:1.1rem;">Showing all 0 candidates</span>
          </div>          

          <!-- Shortlist counter cards -->
          <div class="d-flex gap-3 mb-3">
            <div class="card flex-fill" style="background:linear-gradient(135deg, #28a745, #20c997);text-align:center;border:2px solid #28a745;">
              <span style="font-weight:600;color:#fff;">Shortlisted</span><br>
              <span id="shortlistedCount" style="color:#fff;font-weight:bold;font-size:1.8rem;">0</span>
            </div>
            <div class="card flex-fill" style="background:linear-gradient(135deg, #dc3545, #e74c3c);text-align:center;border:2px solid #dc3545;">
              <span style="font-weight:600;color:#fff;">Not Shortlisted</span><br>
              <span id="notShortlistedCount" style="color:#fff;font-weight:bold;font-size:1.8rem;">0</span>
            </div>
          </div>
<!-- Top navigation buttons -->
          <div class="controls d-flex justify-content-center mb-2 nav-buttons">
            <button id="prevBtnTop" class="btn btn-secondary" disabled>⬅ Previous</button>
            <button id="nextBtnTop" class="btn btn-primary" disabled>Next ➡</button>
          </div>
          
          <!-- Bulk Operations -->
          <div id="bulkOperations" class="card mb-3" style="display: none; background: #1a1a1a; border: 1px solid #333;">
            <div class="card-body">
              <h5 style="color: #bb86fc; margin-bottom: 15px;">🔄 Bulk Operations</h5>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <div class="d-flex align-items-center gap-2 flex-wrap">
                    <input type="checkbox" id="selectAll" class="form-check-input" style="margin-right: 5px;">
                    <label for="selectAll" class="form-check-label" style="color: #e0e0e0;">Select All Visible</label>
                    <span id="selectedCount" style="color: #bb86fc; font-weight: bold; margin-left: 10px;">0 selected</span>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="d-flex gap-2 justify-content-md-end">
                    <button id="bulkApproveBtn" class="btn btn-success btn-sm" disabled>
                      ✅ Approve Selected (<span id="bulkApproveCount">0</span>)
                    </button>
                    <button id="bulkRejectBtn" class="btn btn-danger btn-sm" disabled>
                      ❌ Reject Selected (<span id="bulkRejectCount">0</span>)
                    </button>
                    <button id="bulkClearBtn" class="btn btn-outline-light btn-sm" disabled>
                      🔄 Clear Selection
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card mt-3 section-gap" id="card"></div>

            <div class="d-flex justify-content-center save-row">
              <div class="d-flex flex-column flex-md-row gap-2 align-items-center">
                <button id="saveBtn" class="btn btn-warning" style="min-width:160px;font-weight:600;">💾 Save All Changes</button>
                <button id="downloadApprovedBtn" class="btn btn-success" style="min-width:160px;font-weight:600;">📊 Export Approved</button>
                <button id="downloadContactsBtn" class="btn btn-info" style="min-width:160px;font-weight:600;">📧 Download Contacts</button>
              </div>
            </div>

          <div class="controls d-flex justify-content-center nav-buttons">
            <button id="prevBtn" class="btn btn-secondary" disabled>⬅ Previous</button>
            <button id="nextBtn" class="btn btn-primary" disabled>Next ➡</button>
          </div>
          <div class="footer">Made with <span style="color:#bb86fc;">♥</span> for recruitment teams</div>
        </div>

        <!-- How to Use Modal -->
        <div id="helpModal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h2 class="modal-title">📖 How to Use the Recruitment Viewer</h2>
              <button class="close" id="closeModal">&times;</button>
            </div>
            
            <div class="instruction-section">
              <h3>🗂️ Getting Started</h3>
              <ul>
                <li><strong>Upload File:</strong> Click "Choose file" or drag & drop an Excel file (.xlsx/.xls)</li>
                <li><strong>Supported Format:</strong> Excel files with candidate information in columns</li>
                <li><strong>Automatic Detection:</strong> The app automatically detects column headers</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>🔍 Navigation & Search</h3>
              <ul>
                <li><strong>Browse Candidates:</strong> Use "Previous" and "Next" buttons to navigate</li>
                <li><strong>Keyboard Shortcuts:</strong> <span class="keyboard-shortcut">←</span> Previous, <span class="keyboard-shortcut">→</span> Next</li>
                <li><strong>Search:</strong> Type keywords in the search box to filter candidates</li>
                <li><strong>Tag Search:</strong> Use <span class="keyboard-shortcut">tags:tagname</span> to search by specific tags</li>
                <li><strong>Clear Search:</strong> Empty search box to show all candidates again</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>🏷️ Custom Tags System</h3>
              <ul>
                <li><strong>Add Tags:</strong> Click on the "🏷️ Tags" field for any candidate to add tags</li>
                <li><strong>Edit Tags:</strong> Enter comma-separated tags (e.g., "developer, experienced, python")</li>
                <li><strong>Visual Display:</strong> Tags appear as colored labels for easy identification</li>
                <li><strong>Tag Search:</strong> Use <span class="keyboard-shortcut">tags:developer</span> to find all candidates with "developer" tag</li>
                <li><strong>Auto-Save:</strong> Tags are automatically saved to your Excel file</li>
                <li><strong>Categorization:</strong> Perfect for organizing candidates by skills, experience, or department</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>✅ Reviewing Candidates</h3>
              <ul>
                <li><strong>Individual Actions:</strong> Click "Approve" or "Reject" for single candidates</li>
                <li><strong>Bulk Selection:</strong> Use checkboxes to select multiple candidates</li>
                <li><strong>Select All:</strong> Check "Select All Visible" to select all current candidates</li>
                <li><strong>Bulk Approve:</strong> Click "✅ Approve Selected" to approve multiple candidates at once</li>
                <li><strong>Bulk Reject:</strong> Click "❌ Reject Selected" to reject multiple candidates at once</li>
                <li><strong>Status Tracking:</strong> See live counts of shortlisted/not shortlisted</li>
                <li><strong>Filter View:</strong> Use dropdown to show "All", "Approved", or "Rejected" only</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>🔄 Bulk Operations</h3>
              <ul>
                <li><strong>Efficiency:</strong> Review and approve/reject multiple candidates simultaneously</li>
                <li><strong>Smart Selection:</strong> See real-time count of selected candidates</li>
                <li><strong>Confirmation:</strong> System asks for confirmation before bulk actions</li>
                <li><strong>Clear Selection:</strong> Use "🔄 Clear Selection" to unselect all</li>
                <li><strong>Mobile Friendly:</strong> Bulk operations work on all devices</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>📊 Analytics Dashboard</h3>
              <ul>
                <li><strong>Access Analytics:</strong> Click "📊 Analytics" button to view recruitment insights</li>
                <li><strong>Summary Stats:</strong> View total applications, approval rate, and review progress</li>
                <li><strong>Status Breakdown:</strong> See counts of approved, rejected, and pending candidates</li>
                <li><strong>Email Insights:</strong> Analyze top email domains of applicants</li>
                <li><strong>Education Analysis:</strong> View breakdown of education levels</li>
                <li><strong>Recent Activity:</strong> Track your recent approval/rejection decisions</li>
                <li><strong>Real-time Updates:</strong> Statistics update automatically as you review candidates</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>📊 Filtering & Organization</h3>
              <ul>
                <li><strong>Show All:</strong> View all candidates regardless of status</li>
                <li><strong>Show Approved:</strong> View only shortlisted candidates</li>
                <li><strong>Show Rejected:</strong> View only non-shortlisted candidates</li>
                <li><strong>Status Counter:</strong> Track progress with live counters</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>💾 Saving & Exporting Your Work</h3>
              <ul>
                <li><strong>Save All Changes:</strong> Click "💾 Save All Changes" to download complete Excel file with all candidates</li>
                <li><strong>Export Approved Only:</strong> Click "📊 Export Approved" to download Excel file with only shortlisted candidates</li>
                <li><strong>Download Contact Cards:</strong> Click "📧 Download Contacts" to get VCard (.vcf) file of approved candidates</li>
                <li><strong>Contact Integration:</strong> VCard files can be imported into phone contacts, Outlook, Gmail, etc.</li>
                <li><strong>Preserves Data:</strong> All original data + your shortlist decisions are maintained</li>
                <li><strong>Smart Field Detection:</strong> Automatically finds Name, Email, Phone, Organization fields</li>
                <li><strong>Backup Recommended:</strong> Save regularly to avoid losing progress</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>📧 Contact Management</h3>
              <ul>
                <li><strong>VCard Format:</strong> Industry-standard contact file format (.vcf)</li>
                <li><strong>Multi-Contact File:</strong> Single file contains all approved candidates' contacts</li>
                <li><strong>Auto-Detection:</strong> Finds common field names like "Name", "Email", "Phone", "Mobile", etc.</li>
                <li><strong>Easy Import:</strong> Double-click .vcf file to add contacts to your address book</li>
                <li><strong>Cross-Platform:</strong> Works with iPhone, Android, Outlook, Gmail, Apple Contacts</li>
                <li><strong>Professional Notes:</strong> Each contact includes "Approved candidate from MIC Recruitments 25-26"</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>📱 Mobile & Responsive</h3>
              <ul>
                <li><strong>Touch Friendly:</strong> Optimized for mobile and tablet use</li>
                <li><strong>Swipe Navigation:</strong> Use arrow keys or buttons to navigate</li>
                <li><strong>Responsive Design:</strong> Works on all screen sizes</li>
                <li><strong>Dark Theme:</strong> Easy on eyes during long review sessions</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Patch Notes Modal -->
        <div id="patchModal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h2 class="modal-title">📋 Patch Notes & Version History</h2>
              <button class="close" id="closePatchModal">&times;</button>
            </div>
            
            <div class="instruction-section">
              <h3>� Version 1.6.01 - Enhanced Documentation</h3>
              <p style="color: #aaa; font-size: 0.9rem;">September 20, 2025</p>
              <ul>
                <li><strong>📖 Updated Help System:</strong> Comprehensive documentation for all v1.6 features</li>
                <li><strong>🏷️ Tags Tutorial:</strong> Step-by-step guide for using the custom tags system</li>
                <li><strong>🔄 Bulk Operations Guide:</strong> Detailed instructions for mass candidate management</li>
                <li><strong>📊 Analytics Walkthrough:</strong> Complete overview of dashboard features and insights</li>
                <li><strong>🔍 Advanced Search Tips:</strong> Enhanced search documentation with tag syntax examples</li>
                <li><strong>📱 Mobile Instructions:</strong> Optimized help content for mobile users</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>�🌟 Version 1.6 - Advanced Analytics & Operations</h3>
              <p style="color: #aaa; font-size: 0.9rem;">September 20, 2025</p>
              <ul>
                <li><strong>📊 Analytics Dashboard:</strong> Comprehensive recruitment statistics with approval rates, status breakdown, and insights</li>
                <li><strong>🔄 Bulk Operations:</strong> Mass approve/reject functionality with checkboxes and select all options</li>
                <li><strong>🏷️ Custom Tags System:</strong> Add/edit candidate tags with visual display and color coding</li>
                <li><strong>🔍 Tag-Based Search:</strong> Search candidates by tags using "tags:tagname" syntax</li>
                <li><strong>📈 Email Domain Analysis:</strong> Track application sources by email domains</li>
                <li><strong>🎓 Education Level Insights:</strong> Automated categorization of education backgrounds</li>
                <li><strong>⚡ Recent Activity Tracking:</strong> Real-time view of recent approval/rejection actions</li>
                <li><strong>🎯 Enhanced UX:</strong> Improved candidate navigation with bulk selection interface</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>🚀 Version 1.4 - Advanced Download Features</h3>
              <p style="color: #aaa; font-size: 0.9rem;">September 2025</p>
              <ul>
                <li><strong>📊 Export Approved Only:</strong> Download Excel file with only shortlisted candidates</li>
                <li><strong>📧 VCard Contact Export:</strong> Generate .vcf file for approved candidates' contact info</li>
                <li><strong>🧠 Smart Field Detection:</strong> Automatically detects Name, Email, Phone, Organization fields</li>
                <li><strong>📱 Cross-Platform Contacts:</strong> VCard works with iPhone, Android, Outlook, Gmail</li>
                <li><strong>📝 Professional Notes:</strong> Each contact includes recruitment context</li>
                <li><strong>🎯 Enhanced Validation:</strong> Proper error handling for all download actions</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>📢 Version 1.3 - Help System & Toast Notifications</h3>
              <p style="color: #aaa; font-size: 0.9rem;">September 2025</p>
              <ul>
                <li><strong>❓ How to Use Modal:</strong> Comprehensive instructions modal with detailed guidance</li>
                <li><strong>🍞 Toast Notifications:</strong> 5-second auto-dismiss feedback system</li>
                <li><strong>✅ Action Feedback:</strong> Success/error toasts for approve, reject, filter actions</li>
                <li><strong>📱 Responsive Modal:</strong> Mobile-optimized help system</li>
                <li><strong>⌨️ Keyboard Shortcuts:</strong> Escape key and click-outside to close modals</li>
                <li><strong>🎨 Enhanced UX:</strong> Professional animations and smooth transitions</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>🎨 Version 1.2 - Responsive Design & Visibility</h3>
              <p style="color: #aaa; font-size: 0.9rem;">September 2025</p>
              <ul>
                <li><strong>📱 Viewport Meta Tag:</strong> Critical mobile responsiveness fix</li>
                <li><strong>⚫ Pitch Black Background:</strong> Maximum contrast design (#000000)</li>
                <li><strong>🔍 Search Bar Visibility:</strong> Light gray background with white text</li>
                <li><strong>📋 Form Control Enhancement:</strong> Better visibility for all input fields</li>
                <li><strong>📂 File Picker Improvements:</strong> Enhanced contrast and mobile layout</li>
                <li><strong>🎯 Touch Targets:</strong> 44px minimum height for mobile accessibility</li>
                <li><strong>📐 Responsive Breakpoints:</strong> Desktop, tablet, mobile, small mobile</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>🏗️ Version 1.1 - Core Functionality</h3>
              <p style="color: #aaa; font-size: 0.9rem;">September 2025</p>
              <ul>
                <li><strong>📤 File Upload System:</strong> Excel (.xlsx/.xls) file support with drag & drop</li>
                <li><strong>👥 Candidate Navigation:</strong> Previous/Next buttons with keyboard support</li>
                <li><strong>✅ Approve/Reject System:</strong> Shortlisting workflow with status tracking</li>
                <li><strong>🔍 Search Functionality:</strong> Real-time keyword search across all fields</li>
                <li><strong>📊 Filter Options:</strong> Show All/Approved/Rejected candidate views</li>
                <li><strong>💾 Save System:</strong> Export updated Excel with shortlist decisions</li>
                <li><strong>📈 Live Counters:</strong> Real-time shortlisted/not shortlisted tracking</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>🌟 Version 1.0 - Initial Release</h3>
              <p style="color: #aaa; font-size: 0.9rem;">September 2025</p>
              <ul>
                <li><strong>🎨 Dark Theme UI:</strong> Professional dark theme with purple accents</li>
                <li><strong>📋 Basic Layout:</strong> Header with logo, file picker, and navigation</li>
                <li><strong>📊 Excel Integration:</strong> Basic Excel file reading and processing</li>
                <li><strong>📱 Bootstrap Framework:</strong> Responsive grid system foundation</li>
                <li><strong>🎯 Core Structure:</strong> HTML, CSS, JavaScript foundation</li>
                <li><strong>🏷️ MIC Branding:</strong> Microsoft Innovation Center recruitment theme</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>🔮 Coming Soon</h3>
              <ul>
                <li><strong>� Comments System:</strong> Add notes to candidate profiles</li>
                <li><strong>� Integration APIs:</strong> Connect with external HR systems</li>
                <li><strong>� Theme Customization:</strong> Multiple color schemes</li>
                <li><strong>� Notification System:</strong> Email alerts for new applications</li>
                <li><strong>� Interview Scheduling:</strong> Calendar integration for candidate interviews</li>
                <li><strong>🤖 AI Recommendations:</strong> Smart candidate matching and scoring</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Analytics Dashboard Modal -->
        <div id="analyticsModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
              <h2 class="modal-title">📊 Analytics Dashboard</h2>
              <span class="close" id="analyticsModalClose">&times;</span>
            </div>
            <div class="modal-body">
              <div class="analytics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 25px;">
                <!-- Summary Stats -->
                <div class="analytics-card" style="background: linear-gradient(135deg, #bb86fc, #9c4dcc); padding: 20px; border-radius: 10px; text-align: center;">
                  <h3 style="margin: 0 0 10px 0; color: white;">📝 Total Applications</h3>
                  <div id="totalApplications" style="font-size: 2.5rem; font-weight: bold; color: white;">0</div>
                </div>
                
                <div class="analytics-card" style="background: linear-gradient(135deg, #28a745, #20c997); padding: 20px; border-radius: 10px; text-align: center;">
                  <h3 style="margin: 0 0 10px 0; color: white;">✅ Approval Rate</h3>
                  <div id="approvalRate" style="font-size: 2.5rem; font-weight: bold; color: white;">0%</div>
                </div>
                
                <div class="analytics-card" style="background: linear-gradient(135deg, #17a2b8, #20c997); padding: 20px; border-radius: 10px; text-align: center;">
                  <h3 style="margin: 0 0 10px 0; color: white;">⏱️ Review Progress</h3>
                  <div id="reviewProgress" style="font-size: 2.5rem; font-weight: bold; color: white;">0%</div>
                </div>
              </div>
              
              <!-- Status Breakdown -->
              <div class="analytics-section" style="margin-bottom: 25px;">
                <h3 style="color: #bb86fc; margin-bottom: 15px;">📈 Status Breakdown</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                  <div class="status-item" style="background: #1a1a1a; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                    <div style="color: #28a745; font-weight: 600;">Approved</div>
                    <div id="approvedCount" style="font-size: 1.8rem; font-weight: bold; color: white;">0</div>
                  </div>
                  <div class="status-item" style="background: #1a1a1a; padding: 15px; border-radius: 8px; border-left: 4px solid #dc3545;">
                    <div style="color: #dc3545; font-weight: 600;">Rejected</div>
                    <div id="rejectedCount" style="font-size: 1.8rem; font-weight: bold; color: white;">0</div>
                  </div>
                  <div class="status-item" style="background: #1a1a1a; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <div style="color: #ffc107; font-weight: 600;">Pending Review</div>
                    <div id="pendingCount" style="font-size: 1.8rem; font-weight: bold; color: white;">0</div>
                  </div>
                </div>
              </div>
              
              <!-- Application Insights -->
              <div class="analytics-section" style="margin-bottom: 25px;">
                <h3 style="color: #bb86fc; margin-bottom: 15px;">🔍 Application Insights</h3>
                <div style="background: #1a1a1a; padding: 20px; border-radius: 10px;">
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div>
                      <h4 style="color: #bb86fc; margin-bottom: 10px;">📧 Top Email Domains</h4>
                      <div id="emailDomains" style="color: #e0e0e0;">
                        <!-- Dynamic content -->
                      </div>
                    </div>
                    <div>
                      <h4 style="color: #bb86fc; margin-bottom: 10px;">🎓 Education Levels</h4>
                      <div id="educationLevels" style="color: #e0e0e0;">
                        <!-- Dynamic content -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Recent Activity -->
              <div class="analytics-section">
                <h3 style="color: #bb86fc; margin-bottom: 15px;">⚡ Recent Activity</h3>
                <div id="recentActivity" style="background: #1a1a1a; padding: 20px; border-radius: 10px; max-height: 200px; overflow-y: auto;">
                  <p style="color: #888; text-align: center;">Start reviewing candidates to see recent activity...</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container"></div>

      <script>
          let applications = [];
            let filteredIndexes = [];
            let currentIndex = 0;

          // Tag Library System
          let tagLibrary = new Map(); // stores tag name -> {color, usage count}
          
          // Predefined color palette for tags
          const tagColors = [
            '#28a745', '#17a2b8', '#ffc107', '#dc3545', '#6f42c1',
            '#fd7e14', '#20c997', '#e83e8c', '#6610f2', '#007bff',
            '#6c757d', '#198754', '#0dcaf0', '#f8f9fa', '#212529',
            '#495057', '#adb5bd', '#ced4da', '#dee2e6', '#e9ecef'
          ];

          function addToTagLibrary(tagName, color = null) {
            if (!tagName || tagName.trim() === '') return;
            
            const cleanTag = tagName.trim().toLowerCase();
            if (tagLibrary.has(cleanTag)) {
              // Increment usage count
              const tagData = tagLibrary.get(cleanTag);
              tagData.usageCount++;
              if (color) tagData.color = color; // Update color if provided
            } else {
              // Add new tag with auto-assigned or provided color
              const assignedColor = color || tagColors[tagLibrary.size % tagColors.length];
              tagLibrary.set(cleanTag, {
                color: assignedColor,
                usageCount: 1,
                displayName: tagName.trim() // Keep original case for display
              });
            }
          }

          function getTagColor(tagName) {
            const cleanTag = tagName.trim().toLowerCase();
            if (tagLibrary.has(cleanTag)) {
              return tagLibrary.get(cleanTag).color;
            }
            // Auto-assign color for new tags
            addToTagLibrary(tagName);
            return tagLibrary.get(cleanTag).color;
          }

          function getPopularTags(limit = 10) {
            return Array.from(tagLibrary.entries())
              .sort(([,a], [,b]) => b.usageCount - a.usageCount)
              .slice(0, limit)
              .map(([name, data]) => ({name: data.displayName, color: data.color, count: data.usageCount}));
          }

          // Toast notification system
          function showToast(message, type = 'info', duration = 5000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove after duration
            setTimeout(() => {
              toast.classList.remove('show');
              setTimeout(() => {
                if (toast.parentNode) {
                  toast.parentNode.removeChild(toast);
                }
              }, 300);
            }, duration);
          }

          // Modal functionality
          const modal = document.getElementById('helpModal');
          const helpBtn = document.getElementById('helpBtn');
          const closeBtn = document.getElementById('closeModal');

          helpBtn.addEventListener('click', () => {
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
          });

          closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
          });

          // Close modal when clicking outside
          window.addEventListener('click', (e) => {
            if (e.target === modal) {
              modal.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          });

          // Close modal with Escape key
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && (modal.style.display === 'block' || patchModal.style.display === 'block' || analyticsModal.style.display === 'block')) {
              modal.style.display = 'none';
              patchModal.style.display = 'none';
              analyticsModal.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          });

          // Patch Notes Modal functionality
          const patchModal = document.getElementById('patchModal');
          const patchBtn = document.getElementById('patchBtn');
          const closePatchBtn = document.getElementById('closePatchModal');

          patchBtn.addEventListener('click', () => {
            patchModal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
          });

          closePatchBtn.addEventListener('click', () => {
            patchModal.style.display = 'none';
            document.body.style.overflow = 'auto';
          });

          // Close patch modal when clicking outside
          window.addEventListener('click', (e) => {
            if (e.target === patchModal) {
              patchModal.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          });

          // Analytics Modal functionality
          const analyticsModal = document.getElementById('analyticsModal');
          const analyticsBtn = document.getElementById('analyticsBtn');
          const closeAnalyticsBtn = document.getElementById('analyticsModalClose');

          analyticsBtn.addEventListener('click', () => {
            updateAnalyticsDashboard();
            analyticsModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
          });

          closeAnalyticsBtn.addEventListener('click', () => {
            analyticsModal.style.display = 'none';
            document.body.style.overflow = 'auto';
          });

          // Close analytics modal when clicking outside
          window.addEventListener('click', (e) => {
            if (e.target === analyticsModal) {
              analyticsModal.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          });

          // Analytics Dashboard Functions
          function updateAnalyticsDashboard() {
            if (!applications.length) {
              // Show empty state
              document.getElementById('totalApplications').textContent = '0';
              document.getElementById('approvalRate').textContent = '0%';
              document.getElementById('reviewProgress').textContent = '0%';
              document.getElementById('approvedCount').textContent = '0';
              document.getElementById('rejectedCount').textContent = '0';
              document.getElementById('pendingCount').textContent = '0';
              document.getElementById('emailDomains').innerHTML = '<p style="color: #888;">No data available</p>';
              document.getElementById('educationLevels').innerHTML = '<p style="color: #888;">No data available</p>';
              document.getElementById('recentActivity').innerHTML = '<p style="color: #888; text-align: center;">Upload a file to see analytics...</p>';
              return;
            }

            const total = applications.length;
            const approved = applications.filter(app => app.shortlisted === 'Yes').length;
            const rejected = applications.filter(app => app.shortlisted === 'No').length;
            const pending = total - approved - rejected;
            const reviewed = approved + rejected;
            
            // Update summary stats
            document.getElementById('totalApplications').textContent = total.toLocaleString();
            document.getElementById('approvalRate').textContent = total > 0 ? `${Math.round((approved / total) * 100)}%` : '0%';
            document.getElementById('reviewProgress').textContent = total > 0 ? `${Math.round((reviewed / total) * 100)}%` : '0%';
            
            // Update status breakdown
            document.getElementById('approvedCount').textContent = approved.toLocaleString();
            document.getElementById('rejectedCount').textContent = rejected.toLocaleString();
            document.getElementById('pendingCount').textContent = pending.toLocaleString();
            
            // Email domains analysis
            const emailDomains = {};
            applications.forEach(app => {
              if (app.email) {
                const domain = app.email.split('@')[1]?.toLowerCase();
                if (domain) {
                  emailDomains[domain] = (emailDomains[domain] || 0) + 1;
                }
              }
            });
            
            const topDomains = Object.entries(emailDomains)
              .sort(([,a], [,b]) => b - a)
              .slice(0, 5)
              .map(([domain, count]) => `<div style="margin-bottom: 5px;"><span style="color: #bb86fc;">${domain}</span>: ${count}</div>`)
              .join('');
            document.getElementById('emailDomains').innerHTML = topDomains || '<p style="color: #888;">No email data</p>';
            
            // Education levels analysis
            const educationLevels = {};
            applications.forEach(app => {
              if (app.education) {
                const edu = app.education.toString().toLowerCase();
                if (edu.includes('bachelor') || edu.includes('btech') || edu.includes('be ') || edu.includes('b.tech') || edu.includes('b.e')) {
                  educationLevels['Bachelor\'s'] = (educationLevels['Bachelor\'s'] || 0) + 1;
                } else if (edu.includes('master') || edu.includes('mtech') || edu.includes('me ') || edu.includes('m.tech') || edu.includes('m.e') || edu.includes('mba')) {
                  educationLevels['Master\'s'] = (educationLevels['Master\'s'] || 0) + 1;
                } else if (edu.includes('phd') || edu.includes('doctorate')) {
                  educationLevels['PhD'] = (educationLevels['PhD'] || 0) + 1;
                } else if (edu.includes('diploma') || edu.includes('certificate')) {
                  educationLevels['Diploma'] = (educationLevels['Diploma'] || 0) + 1;
                } else {
                  educationLevels['Other'] = (educationLevels['Other'] || 0) + 1;
                }
              }
            });
            
            const eduBreakdown = Object.entries(educationLevels)
              .sort(([,a], [,b]) => b - a)
              .map(([level, count]) => `<div style="margin-bottom: 5px;"><span style="color: #bb86fc;">${level}</span>: ${count}</div>`)
              .join('');
            document.getElementById('educationLevels').innerHTML = eduBreakdown || '<p style="color: #888;">No education data</p>';
            
            // Recent activity (show last 10 status changes)
            const recentActivities = applications
              .filter(app => app.shortlisted === 'Yes' || app.shortlisted === 'No')
              .slice(-10)
              .reverse()
              .map(app => {
                const status = app.shortlisted === 'Yes' ? 
                  '<span style="color: #28a745;">✅ Approved</span>' : 
                  '<span style="color: #dc3545;">❌ Rejected</span>';
                const name = app.name || 'Unknown';
                return `<div style="margin-bottom: 8px; padding: 8px; background: #2a2a2a; border-radius: 5px;">${status} - ${name}</div>`;
              })
              .join('');
            
            document.getElementById('recentActivity').innerHTML = 
              recentActivities || '<p style="color: #888; text-align: center;">No review activity yet...</p>';
          }

          // Bulk Operations System
          let selectedCandidates = new Set();

          function updateBulkOperationButtons() {
            const checkboxes = document.querySelectorAll('.candidate-checkbox:checked');
            const selectedCount = checkboxes.length;
            selectedCandidates.clear();
            
            checkboxes.forEach(checkbox => {
              const appIndex = parseInt(checkbox.id.split('_')[1]);
              selectedCandidates.add(appIndex);
            });
            
            document.getElementById('selectedCount').textContent = `${selectedCount} selected`;
            document.getElementById('bulkApproveCount').textContent = selectedCount;
            document.getElementById('bulkRejectCount').textContent = selectedCount;
            
            const bulkApproveBtn = document.getElementById('bulkApproveBtn');
            const bulkRejectBtn = document.getElementById('bulkRejectBtn');
            const bulkClearBtn = document.getElementById('bulkClearBtn');
            
            bulkApproveBtn.disabled = selectedCount === 0;
            bulkRejectBtn.disabled = selectedCount === 0;
            bulkClearBtn.disabled = selectedCount === 0;
            
            // Update select all checkbox
            const totalVisible = document.querySelectorAll('.candidate-checkbox').length;
            const selectAllCheckbox = document.getElementById('selectAll');
            if (totalVisible > 0) {
              selectAllCheckbox.indeterminate = selectedCount > 0 && selectedCount < totalVisible;
              selectAllCheckbox.checked = selectedCount === totalVisible && totalVisible > 0;
            }
          }

          function showBulkOperations() {
            if (applications.length > 0) {
              document.getElementById('bulkOperations').style.display = 'block';
            }
          }

          function hideBulkOperations() {
            document.getElementById('bulkOperations').style.display = 'none';
            selectedCandidates.clear();
            updateBulkOperationButtons();
          }

          // Event listeners for bulk operations
          document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.candidate-checkbox');
            checkboxes.forEach(checkbox => {
              checkbox.checked = this.checked;
            });
            updateBulkOperationButtons();
          });

          document.getElementById('bulkApproveBtn').addEventListener('click', function() {
            if (selectedCandidates.size === 0) return;
            
            const confirmed = confirm(`Are you sure you want to approve ${selectedCandidates.size} candidate(s)?`);
            if (!confirmed) return;
            
            selectedCandidates.forEach(appIndex => {
              if (applications[appIndex]) {
                applications[appIndex].shortlisted = 'Yes';
              }
            });
            
            updateShortlistCounter();
            showCandidate(currentIndex); // Refresh current view
            showToast(`✅ Successfully approved ${selectedCandidates.size} candidate(s)`, 'success');
            updateBulkOperationButtons();
          });

          document.getElementById('bulkRejectBtn').addEventListener('click', function() {
            if (selectedCandidates.size === 0) return;
            
            const confirmed = confirm(`Are you sure you want to reject ${selectedCandidates.size} candidate(s)?`);
            if (!confirmed) return;
            
            selectedCandidates.forEach(appIndex => {
              if (applications[appIndex]) {
                applications[appIndex].shortlisted = 'No';
              }
            });
            
            updateShortlistCounter();
            showCandidate(currentIndex); // Refresh current view
            showToast(`❌ Successfully rejected ${selectedCandidates.size} candidate(s)`, 'error');
            updateBulkOperationButtons();
          });

          document.getElementById('bulkClearBtn').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('.candidate-checkbox');
            checkboxes.forEach(checkbox => {
              checkbox.checked = false;
            });
            document.getElementById('selectAll').checked = false;
            updateBulkOperationButtons();
          });

          // Tags System Functions
          function updateTagsDisplay(appIndex, tagsString) {
            const tagsDisplay = document.getElementById(`tagsDisplay_${appIndex}`);
            if (!tagsDisplay) return;
            
            tagsDisplay.innerHTML = '';
            
            if (!tagsString || tagsString.trim() === '') {
              tagsDisplay.innerHTML = '<span style="color: #888; font-style: italic;">No tags added. Click to add tags...</span>';
              return;
            }
            
            const tags = tagsString.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
            
            if (tags.length === 0) {
              tagsDisplay.innerHTML = '<span style="color: #888; font-style: italic;">No tags added. Click to add tags...</span>';
              return;
            }
            
            const tagsHtml = tags.map(tag => {
              const bgColor = getTagColor(tag);
              
              return `<span style="
                display: inline-block;
                background: ${bgColor};
                color: white;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 0.8rem;
                font-weight: 500;
                margin: 2px 4px 2px 0;
                box-shadow: 0 1px 3px rgba(0,0,0,0.2);
              ">${tag}</span>`;
            }).join('');
            
            tagsDisplay.innerHTML = tagsHtml;
          }

          function filterByTags(searchTags) {
            if (!searchTags || searchTags.trim() === '') return applications.map((_, index) => index);
            
            const searchTagsArray = searchTags.toLowerCase().split(',').map(tag => tag.trim());
            
            return applications.map((app, index) => {
              if (!app.tags) return null;
              const appTags = app.tags.toLowerCase().split(',').map(tag => tag.trim());
              const hasMatchingTag = searchTagsArray.some(searchTag => 
                appTags.some(appTag => appTag.includes(searchTag))
              );
              return hasMatchingTag ? index : null;
            }).filter(index => index !== null);
          }

          document.getElementById('fileInput').addEventListener('change', handleFile, false);
          // New file picker UI wiring
          const chooseFileBtn = document.getElementById('chooseFileBtn');
          const dropzone = document.getElementById('dropzone');
          const fileNameEl = document.getElementById('fileName');
          const clearFileBtn = document.getElementById('clearFileBtn');

          chooseFileBtn.addEventListener('click', () => document.getElementById('fileInput').click());
          clearFileBtn.addEventListener('click', () => {
            document.getElementById('fileInput').value = '';
            fileNameEl.textContent = 'No file selected';
            clearFileBtn.style.display = 'none';
            applications = [];
            filteredIndexes = [];
            document.getElementById('card').innerHTML = '';
            updateShortlistCounter();
            hideBulkOperations();
          });

          // Drag and drop
          dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.style.borderColor = '#bb86fc'; });
          dropzone.addEventListener('dragleave', () => { dropzone.style.borderColor = '#666666'; });
          dropzone.addEventListener('drop', (e) => {
            e.preventDefault(); dropzone.style.borderColor = '#666666';
            const file = e.dataTransfer.files[0];
            if (file) {
              const input = document.getElementById('fileInput');
              const dt = new DataTransfer();
              dt.items.add(file);
              input.files = dt.files;
              handleFile({ target: input });
              fileNameEl.textContent = file.name;
              clearFileBtn.style.display = 'inline-block';
            }
          });
          document.getElementById('nextBtn').addEventListener('click', () => showCandidate(currentIndex + 1));
          document.getElementById('prevBtn').addEventListener('click', () => showCandidate(currentIndex - 1));
          document.getElementById('nextBtnTop').addEventListener('click', () => showCandidate(currentIndex + 1));
          document.getElementById('prevBtnTop').addEventListener('click', () => showCandidate(currentIndex - 1));
          document.getElementById('searchInput').addEventListener('input', handleSearch);
          document.addEventListener('keydown', handleArrowKeys);
          document.getElementById('filterSelect').addEventListener('change', handleFilter);
          document.getElementById('saveBtn').addEventListener('click', function() {
            if (applications.length === 0) {
              showToast('⚠️ No data to save. Please load a file first.', 'error');
              return;
            }
            const ws = XLSX.utils.json_to_sheet(applications);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
            XLSX.writeFile(wb, 'updated_candidates.xlsx');
            showToast('💾 File saved successfully as "updated_candidates.xlsx"', 'success');
          });

          // Download approved candidates only
          document.getElementById('downloadApprovedBtn').addEventListener('click', function() {
            const approvedCandidates = applications.filter(app => app['shortlisted'] === 'TRUE');
            if (approvedCandidates.length === 0) {
              showToast('⚠️ No approved candidates to export. Please approve some candidates first.', 'error');
              return;
            }
            const ws = XLSX.utils.json_to_sheet(approvedCandidates);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Approved Candidates');
            XLSX.writeFile(wb, 'approved_candidates.xlsx');
            showToast(`📊 Exported ${approvedCandidates.length} approved candidates successfully!`, 'success');
          });

          // Download VCard contacts
          document.getElementById('downloadContactsBtn').addEventListener('click', function() {
            const approvedCandidates = applications.filter(app => app['shortlisted'] === 'TRUE');
            if (approvedCandidates.length === 0) {
              showToast('⚠️ No approved candidates to export contacts. Please approve some candidates first.', 'error');
              return;
            }
            downloadVCardContacts(approvedCandidates);
            showToast(`📧 Downloaded contact cards for ${approvedCandidates.length} approved candidates!`, 'success');
          });

          // VCard generation function
          function downloadVCardContacts(candidates) {
            let vCardContent = '';
            
            candidates.forEach((candidate, index) => {
              // Try to find common field names for contact info
              const name = candidate.Name || candidate.name || candidate['Full Name'] || candidate['Candidate Name'] || `Candidate ${index + 1}`;
              const email = candidate.Email || candidate.email || candidate['Email Address'] || candidate['Email ID'] || '';
              const phone = candidate.Phone || candidate.phone || candidate['Mobile'] || candidate['Contact'] || candidate['Phone Number'] || '';
              const organization = candidate.Organization || candidate.organization || candidate.Company || candidate.company || '';
              
              // Generate VCard for each candidate
              vCardContent += `BEGIN:VCARD\n`;
              vCardContent += `VERSION:3.0\n`;
              vCardContent += `FN:${name}\n`;
              vCardContent += `N:${name};;;;\n`;
              
              if (email) {
                vCardContent += `EMAIL:${email}\n`;
              }
              
              if (phone) {
                vCardContent += `TEL:${phone}\n`;
              }
              
              if (organization) {
                vCardContent += `ORG:${organization}\n`;
              }
              
              vCardContent += `NOTE:Approved candidate from MIC Recruitments 25-26\n`;
              vCardContent += `END:VCARD\n\n`;
            });
            
            // Create and download the VCard file
            const blob = new Blob([vCardContent], { type: 'text/vcard;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'approved_candidates_contacts.vcf';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
          }

          function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const sheetName = workbook.SheetNames[0];
              const sheet = workbook.Sheets[sheetName];
              const json = XLSX.utils.sheet_to_json(sheet);

              // Ensure 'shortlisted' and 'tags' fields exist with defaults
              applications = json.map(app => {
                if (!('shortlisted' in app)) app['shortlisted'] = 'FALSE';
                if (!('tags' in app)) app['tags'] = '';
                return app;
              });
              
                // Initialize tag library from existing tags
                tagLibrary.clear();
                applications.forEach(app => {
                  if (app.tags && app.tags.trim()) {
                    const tags = app.tags.split(',').map(tag => tag.trim()).filter(tag => tag);
                    tags.forEach(tag => addToTagLibrary(tag));
                  }
                });
                
                applyFilter();
                
                // Show success toast
                showToast(`📁 File loaded successfully! Found ${applications.length} candidates`, 'success');
                
                // Show bulk operations panel
                showBulkOperations();
                
              // update file name display
              const fileInput = document.getElementById('fileInput');
              const fileNameEl = document.getElementById('fileName');
              const clearFileBtn = document.getElementById('clearFileBtn');
              if (fileInput.files[0]) {
                fileNameEl.textContent = fileInput.files[0].name;
                clearFileBtn.style.display = 'inline-block';
              }
            };
            reader.readAsArrayBuffer(file);
          }

          function showCandidate(index) {
          if (filteredIndexes.length === 0) return;
          if (index < 0 || index >= filteredIndexes.length) return;

          currentIndex = index;
          const appIndex = filteredIndexes[currentIndex];
          const card = document.getElementById('card');
          card.innerHTML = '';

          const candidate = applications[appIndex];
          
          // Add bulk selection checkbox at the top
          const checkboxWrapper = document.createElement('div');
          checkboxWrapper.className = 'mb-3 d-flex align-items-center gap-2';
          checkboxWrapper.style.background = '#2a2a2a';
          checkboxWrapper.style.padding = '10px';
          checkboxWrapper.style.borderRadius = '8px';
          checkboxWrapper.style.border = '1px solid #444';
          
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `candidateCheckbox_${appIndex}`;
          checkbox.className = 'form-check-input candidate-checkbox';
          checkbox.style.marginRight = '8px';
          
          const checkboxLabel = document.createElement('label');
          checkboxLabel.htmlFor = `candidateCheckbox_${appIndex}`;
          checkboxLabel.className = 'form-check-label';
          checkboxLabel.style.color = '#bb86fc';
          checkboxLabel.style.fontWeight = '600';
          checkboxLabel.textContent = '🎯 Select for bulk operations';
          
          checkboxWrapper.appendChild(checkbox);
          checkboxWrapper.appendChild(checkboxLabel);
          card.appendChild(checkboxWrapper);
          
          // Add event listener for checkbox
          checkbox.addEventListener('change', updateBulkOperationButtons);
            for (const key in candidate) {
              const wrapper = document.createElement('div');
              wrapper.className = 'mb-3';

              const label = document.createElement('label');
              label.className = 'form-label';
              label.textContent = key;

              // Special handling for tags field
              if (key.toLowerCase() === 'tags') {
                label.innerHTML = '🏷️ Tags <small style="color: #888;">(Click to edit)</small>';
                
                // Tags display and input container
                const tagsContainer = document.createElement('div');
                tagsContainer.style.background = '#2a2a2a';
                tagsContainer.style.border = '2px solid #555555';
                tagsContainer.style.borderRadius = '8px';
                tagsContainer.style.padding = '10px';
                tagsContainer.style.minHeight = '50px';
                tagsContainer.style.cursor = 'pointer';
                
                // Tags display area
                const tagsDisplay = document.createElement('div');
                tagsDisplay.id = `tagsDisplay_${appIndex}`;
                tagsDisplay.style.marginBottom = '8px';
                
                // Tags input area (initially hidden)
                const tagsInputArea = document.createElement('div');
                tagsInputArea.style.display = 'none';
                tagsInputArea.style.marginTop = '8px';
                
                // Popular tags section
                const popularTagsSection = document.createElement('div');
                popularTagsSection.style.marginBottom = '10px';
                
                const popularTagsLabel = document.createElement('div');
                popularTagsLabel.innerHTML = '<small style="color: #bb86fc; font-weight: 600;">🔥 Popular Tags (click to add):</small>';
                popularTagsSection.appendChild(popularTagsLabel);
                
                const popularTagsContainer = document.createElement('div');
                popularTagsContainer.style.marginTop = '5px';
                popularTagsContainer.style.maxHeight = '80px';
                popularTagsContainer.style.overflowY = 'auto';
                
                // Update popular tags display
                function updatePopularTagsDisplay() {
                  popularTagsContainer.innerHTML = '';
                  const popularTags = getPopularTags(15);
                  
                  if (popularTags.length === 0) {
                    popularTagsContainer.innerHTML = '<small style="color: #888;">No tags used yet. Add some tags to see them here!</small>';
                    return;
                  }
                  
                  popularTags.forEach(tag => {
                    const tagBtn = document.createElement('button');
                    tagBtn.className = 'btn btn-sm me-1 mb-1';
                    tagBtn.style.background = tag.color;
                    tagBtn.style.color = 'white';
                    tagBtn.style.border = 'none';
                    tagBtn.style.fontSize = '0.75rem';
                    tagBtn.innerHTML = `${tag.name} <span style="opacity: 0.7;">(${tag.count})</span>`;
                    
                    tagBtn.addEventListener('click', function() {
                      const currentTags = tagsInput.value.split(',').map(t => t.trim()).filter(t => t);
                      if (!currentTags.includes(tag.name)) {
                        currentTags.push(tag.name);
                        tagsInput.value = currentTags.join(', ');
                      }
                    });
                    
                    popularTagsContainer.appendChild(tagBtn);
                  });
                }
                
                popularTagsSection.appendChild(popularTagsContainer);
                
                const tagsInput = document.createElement('input');
                tagsInput.type = 'text';
                tagsInput.className = 'form-control mb-2';
                tagsInput.placeholder = 'Add tags (comma-separated) or click popular tags above...';
                tagsInput.style.background = '#3a3a3a';
                tagsInput.style.border = '1px solid #bb86fc';
                tagsInput.style.color = '#ffffff';
                
                // Color picker section
                const colorPickerSection = document.createElement('div');
                colorPickerSection.className = 'mb-2';
                
                const colorPickerLabel = document.createElement('div');
                colorPickerLabel.innerHTML = '<small style="color: #bb86fc; font-weight: 600;">🎨 Choose colors for new tags:</small>';
                colorPickerSection.appendChild(colorPickerLabel);
                
                const colorPalette = document.createElement('div');
                colorPalette.style.display = 'flex';
                colorPalette.style.flexWrap = 'wrap';
                colorPalette.style.gap = '4px';
                colorPalette.style.marginTop = '5px';
                
                let selectedColor = tagColors[0]; // Default color
                
                tagColors.forEach((color, index) => {
                  const colorBtn = document.createElement('button');
                  colorBtn.type = 'button';
                  colorBtn.style.width = '20px';
                  colorBtn.style.height = '20px';
                  colorBtn.style.backgroundColor = color;
                  colorBtn.style.border = index === 0 ? '2px solid #fff' : '1px solid #666';
                  colorBtn.style.borderRadius = '3px';
                  colorBtn.style.cursor = 'pointer';
                  colorBtn.title = `Color ${index + 1}`;
                  
                  colorBtn.addEventListener('click', function() {
                    // Remove selection from all color buttons
                    colorPalette.querySelectorAll('button').forEach(btn => {
                      btn.style.border = '1px solid #666';
                    });
                    // Select this color
                    colorBtn.style.border = '2px solid #fff';
                    selectedColor = color;
                  });
                  
                  colorPalette.appendChild(colorBtn);
                });
                
                colorPickerSection.appendChild(colorPalette);
                
                const tagsButtons = document.createElement('div');
                tagsButtons.className = 'd-flex gap-2 mt-2';
                
                const saveTagsBtn = document.createElement('button');
                saveTagsBtn.className = 'btn btn-success btn-sm';
                saveTagsBtn.textContent = '✓ Save';
                
                const cancelTagsBtn = document.createElement('button');
                cancelTagsBtn.className = 'btn btn-secondary btn-sm';
                cancelTagsBtn.textContent = '✕ Cancel';
                
                tagsButtons.appendChild(saveTagsBtn);
                tagsButtons.appendChild(cancelTagsBtn);
                
                tagsInputArea.appendChild(popularTagsSection);
                tagsInputArea.appendChild(tagsInput);
                tagsInputArea.appendChild(colorPickerSection);
                tagsInputArea.appendChild(tagsButtons);
                
                tagsContainer.appendChild(tagsDisplay);
                tagsContainer.appendChild(tagsInputArea);
                
                // Event listeners for tags editing
                tagsContainer.addEventListener('click', function(e) {
                  if (e.target === tagsContainer || e.target === tagsDisplay) {
                    tagsInputArea.style.display = 'block';
                    tagsInput.value = candidate.tags || '';
                    updatePopularTagsDisplay(); // Refresh popular tags
                    tagsInput.focus();
                  }
                });
                
                saveTagsBtn.addEventListener('click', function() {
                  const newTags = tagsInput.value.trim();
                  
                  // Add new tags to library with selected color
                  if (newTags) {
                    const tagArray = newTags.split(',').map(tag => tag.trim()).filter(tag => tag);
                    tagArray.forEach(tag => {
                      if (!tagLibrary.has(tag.toLowerCase())) {
                        addToTagLibrary(tag, selectedColor);
                      } else {
                        addToTagLibrary(tag); // Just increment usage count
                      }
                    });
                  }
                  
                  candidate.tags = newTags;
                  updateTagsDisplay(appIndex, newTags);
                  tagsInputArea.style.display = 'none';
                  showToast('🏷️ Tags updated successfully!', 'success');
                });
                
                cancelTagsBtn.addEventListener('click', function() {
                  tagsInputArea.style.display = 'none';
                });
                
                // Enter to save, Escape to cancel
                tagsInput.addEventListener('keydown', function(e) {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    saveTagsBtn.click();
                  } else if (e.key === 'Escape') {
                    cancelTagsBtn.click();
                  }
                });
                
                wrapper.appendChild(label);
                wrapper.appendChild(tagsContainer);
                
                // Initialize tags display
                updateTagsDisplay(appIndex, candidate.tags || '');
                
              } else {
                // Regular field handling
                const textarea = document.createElement('textarea');
                textarea.className = 'form-control';
                textarea.rows = 2;
                textarea.readOnly = true;
                textarea.value = candidate[key];

                // Add a subtle highlight for important fields
                if (key.toLowerCase().includes('name') || key.toLowerCase().includes('email')) {
                  textarea.style.background = 'linear-gradient(90deg,#bb86fc22,#232526)';
                  textarea.style.fontWeight = 'bold';
                }

                // Highlight shortlisted field
                if (key.toLowerCase() === 'shortlisted') {
                  textarea.style.background = candidate[key] === 'TRUE' ? 'linear-gradient(90deg,#bb86fc88,#232526)' : 'linear-gradient(90deg,#232526,#bb86fc22)';
                  textarea.style.color = candidate[key] === 'TRUE' ? '#fff' : '#e0e0e0';
                  textarea.style.fontWeight = 'bold';
                }

                wrapper.appendChild(label);
                wrapper.appendChild(textarea);
              }
              card.appendChild(wrapper);
            }

              // Approve/Reject button group
              const btnGroup = document.createElement('div');
              btnGroup.className = 'd-flex gap-2 mb-2';

              const approveBtn = document.createElement('button');
              approveBtn.className = 'btn btn-success flex-fill';
              approveBtn.textContent = candidate['shortlisted'] === 'TRUE' ? 'Shortlisted' : 'Approve Candidate';
              approveBtn.disabled = candidate['shortlisted'] === 'TRUE';
              approveBtn.onclick = function() {
                candidate['shortlisted'] = 'TRUE';
                showToast('✅ Candidate approved and shortlisted!', 'success');
                applyFilter(appIndex);
              };
              btnGroup.appendChild(approveBtn);

              const rejectBtn = document.createElement('button');
              rejectBtn.className = 'btn btn-danger flex-fill';
              rejectBtn.textContent = 'Reject Candidate';
              rejectBtn.disabled = candidate['shortlisted'] !== 'TRUE';
              rejectBtn.onclick = function() {
                candidate['shortlisted'] = 'FALSE';
                showToast('❌ Candidate rejected and removed from shortlist', 'error');
                applyFilter(appIndex);
              };
              btnGroup.appendChild(rejectBtn);

              card.appendChild(btnGroup);

            document.getElementById('prevBtn').disabled = (currentIndex === 0);
            document.getElementById('nextBtn').disabled = (currentIndex === filteredIndexes.length - 1);
            document.getElementById('prevBtnTop').disabled = (currentIndex === 0);
            document.getElementById('nextBtnTop').disabled = (currentIndex === filteredIndexes.length - 1);
            updateShortlistCounter();
          }

          function handleSearch() {
              const query = document.getElementById('searchInput').value.toLowerCase();
              if (!query) {
                applyFilter();
                return;
              }
              
              // Check if query starts with "tags:" for tag-specific search
              if (query.startsWith('tags:')) {
                const tagQuery = query.substring(5).trim();
                const tagFilteredIndexes = filterByTags(tagQuery);
                filteredIndexes = filteredIndexes.filter(idx => tagFilteredIndexes.includes(idx));
              } else {
                // Filter indexes by general search (including tags)
                filteredIndexes = filteredIndexes.filter(idx => {
                  const app = applications[idx];
                  return Object.values(app).some(val => String(val).toLowerCase().includes(query));
                });
              }
              
              currentIndex = 0;
              showCandidate(currentIndex);
          }

          function handleArrowKeys(e) {
              if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
              if (e.key === 'ArrowLeft') {
                showCandidate(currentIndex - 1);
              } else if (e.key === 'ArrowRight') {
                showCandidate(currentIndex + 1);
              }
          }

          function updateShortlistCounter() {
            const shortlisted = applications.filter(app => app['shortlisted'] === 'TRUE').length;
            const notShortlisted = applications.filter(app => app['shortlisted'] !== 'TRUE').length;
            document.getElementById('shortlistedCount').textContent = shortlisted;
            document.getElementById('notShortlistedCount').textContent = notShortlisted;
            
            // Update filter status text
            updateFilterStatusText();
          }

          function handleFilter() {
            const filter = document.getElementById('filterSelect').value;
            const filterMessages = {
              'all': '📋 Showing all candidates',
              'approved': '✅ Showing only approved candidates',
              'rejected': '❌ Showing only rejected candidates'
            };
            
            if (filterMessages[filter]) {
              showToast(filterMessages[filter], 'info');
            }
            
            applyFilter();
          }

          function applyFilter(jumpToIndex) {
            const filter = document.getElementById('filterSelect').value;
            if (filter === 'all') {
              filteredIndexes = applications.map((_, idx) => idx);
            } else if (filter === 'approved') {
              filteredIndexes = applications.map((app, idx) => app['shortlisted'] === 'TRUE' ? idx : null).filter(idx => idx !== null);
            } else if (filter === 'rejected') {
              filteredIndexes = applications.map((app, idx) => app['shortlisted'] !== 'TRUE' ? idx : null).filter(idx => idx !== null);
            }
            // Reset search filter
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query) {
              filteredIndexes = filteredIndexes.filter(idx => {
                const app = applications[idx];
                return Object.values(app).some(val => String(val).toLowerCase().includes(query));
              });
            }
            // Jump to current candidate if possible
            if (filteredIndexes.length === 0) {
              document.getElementById('card').innerHTML = '<div class="text-center text-muted">No candidates found.</div>';
              updateShortlistCounter();
              return;
            }
            if (jumpToIndex !== undefined) {
              // If candidate was just approved/rejected, jump to their new index
              const idx = filteredIndexes.indexOf(jumpToIndex);
              currentIndex = idx !== -1 ? idx : 0;
            } else {
              currentIndex = 0;
            }
            showCandidate(currentIndex);
          }

          function updateFilterStatusText() {
            const filter = document.getElementById('filterSelect').value;
            const total = filteredIndexes.length;
            const statusText = document.getElementById('filterStatusText');
            
            if (filter === 'all') {
              statusText.textContent = `Showing all ${total} candidates`;
            } else if (filter === 'approved') {
              statusText.textContent = `Showing all ${total} shortlisted candidates`;
            } else if (filter === 'rejected') {
              statusText.textContent = `Showing all ${total} not shortlisted candidates`;
            }
          }

        </script>
    </body>
