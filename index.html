<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recruitment Applications Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #000000;
      color: #e0e0e0;
      padding: 30px;
    }
    .main-container {
      max-width: 800px;
      margin: 0 auto;
      overflow-x: hidden;
    }
    .card {
      background-color: #1a1a1a;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.8);
      border: 1px solid #333333;
    }
    .form-label {
      font-weight: 600;
      color: #bb86fc;
    }
    .form-control {
      background-color: #2a2a2a;
      color: #ffffff;
      border: 2px solid #555555;
    }
    .form-control:focus {
      background-color: #3a3a3a;
      border-color: #bb86fc;
      box-shadow: 0 0 0 0.2rem rgba(187, 134, 252, 0.25);
      color: #ffffff;
    }
    .form-select {
      background-color: #2a2a2a;
      color: #ffffff;
      border: 2px solid #555555;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e");
    }
    .form-select:focus {
      background-color: #3a3a3a;
      border-color: #bb86fc;
      box-shadow: 0 0 0 0.2rem rgba(187, 134, 252, 0.25);
      color: #ffffff;
    }
    .controls button {
      min-width: 120px;
      min-height: 44px; /* Minimum touch target size */
    }
    .controls {
      margin-top: 12px;
    }
    .nav-buttons {
      gap: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    /* Section spacing helpers */
    .section-gap {
      margin-top: 8px;
      margin-bottom: 10px;
    }
    .save-row {
      margin-top: 4px; /* tightened spacing above save button */
      margin-bottom: 14px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    h1 {
      color: #bb86fc;
      text-align: center;
      margin-bottom: 25px;
    }
    #searchInput {
      max-width: 400px;
      margin: 15px auto;
      display: block;
      background-color: #2a2a2a !important;
      border: 2px solid #555555 !important;
      color: #ffffff !important;
    }
    #searchInput:focus {
      background-color: #3a3a3a !important;
      border-color: #bb86fc !important;
      box-shadow: 0 0 0 0.2rem rgba(187, 134, 252, 0.25) !important;
    }
    #searchInput::placeholder {
      color: #aaaaaa !important;
    }
    .footer {
      text-align: center;
      color: #888;
      margin-top: 18px;
      font-size: 0.98rem;
      letter-spacing: 0.5px;
    }
    .header-container {
      position: relative;
      margin-bottom: 20px;
      text-align: center;
      padding-top: 20px;
      padding-bottom: 8px;
    }
    .logo {
      display: block;
      margin: 0 auto 12px auto;
      width: 96px;
      height: auto;
      object-fit: contain;
    }
    .mic-gradient {
      background: linear-gradient(45deg, #f25022 0%, #7fba00 25%, #00a4ef 50%, #ffb900 75%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Tablet and medium screens */
    @media (max-width: 992px) and (min-width: 769px) {
      body {
        padding: 25px;
      }
      .main-container {
        padding: 25px 20px;
      }
      h1 {
        font-size: 1.8rem;
      }
      .logo {
        width: 80px;
      }
      .controls button {
        min-width: 100px;
      }
    }
    
    /* Mobile and Tablet Responsive Styles */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      .main-container {
        padding: 20px 15px;
      }
      .header-container {
        padding-left: 20px;
        padding-top: 10px;
      }
      h1 {
        font-size: 1.6rem;
        margin-bottom: 10px;
      }
      .logo {
        width: 72px;
      }
      .card {
        padding: 15px;
      }
      .controls {
        flex-direction: row !important;
        gap: 10px;
        width: 100%;
      }
      .nav-buttons {
        width: 100%;
        justify-content: space-between;
        gap: 10px;
      }
      .controls button {
        min-width: auto;
        flex: 1;
        font-size: 0.9rem;
        padding: 10px 8px;
      }
      .d-flex.gap-3 {
        flex-direction: column;
        gap: 15px;
      }
      .form-control, .form-select {
        font-size: 16px; /* Prevents zoom on iOS */
      }
      #fileInput, #searchInput, #filterSelect {
        max-width: 100%;
      }
      /* Improve file picker layout on mobile */
      #dropzone {
        flex-direction: column;
        gap: 10px;
        padding: 15px;
        text-align: center;
      }
      #dropzone > div:first-child {
        flex-direction: column;
        gap: 8px;
      }
      #chooseFileBtn {
        min-width: auto;
        width: 100%;
      }
      /* Download buttons mobile layout */
      .save-row .d-flex {
        flex-direction: column;
        gap: 10px;
        width: 100%;
      }
      .save-row .btn {
        width: 100%;
        min-width: auto;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      .main-container {
        padding: 12px 8px;
      }
      h1 {
        font-size: 1.4rem;
        line-height: 1.3;
      }
      .header-container {
        padding-left: 8px;
      }
      .logo {
        width: 56px;
      }
      .card {
        padding: 12px;
        margin-bottom: 15px;
      }
      .form-label {
        font-size: 0.95rem;
      }
      .btn {
        font-size: 0.85rem;
        padding: 8px 10px;
      }
      .footer {
        text-align: center;
        margin-top: 14px;
        font-size: 0.9rem;
      }
      #filterStatusText {
        font-size: 0.95rem;
      }
      /* Extra small screens - ensure no horizontal overflow */
      .d-flex.gap-3 {
        margin-left: -4px;
        margin-right: -4px;
      }
      .d-flex.gap-3 > .card {
        margin-left: 4px;
        margin-right: 4px;
      }
      /* Better button spacing */
      .controls button {
        font-size: 0.85rem;
        padding: 8px 6px;
      }
      /* Ensure proper spacing for save button on mobile */
      #saveBtn {
        margin-top: 20px !important;
        margin-bottom: 20px !important;
      }
      /* Improve dropzone on very small screens */
      #dropzone {
        padding: 12px 8px;
      }
    }
    
    /* Toast Notification Styles */
    .toast-container {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1050;
    }
    
    .toast {
      background-color: #2a2a2a;
      color: #ffffff;
      border: 1px solid #555555;
      border-radius: 8px;
      padding: 12px 20px;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.7);
      opacity: 0;
      transform: translateY(100px);
      transition: all 0.3s ease-in-out;
      min-width: 300px;
      text-align: center;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .toast.success {
      border-left: 4px solid #28a745;
      background: linear-gradient(135deg, #28a745, #20c997);
    }
    
    .toast.error {
      border-left: 4px solid #dc3545;
      background: linear-gradient(135deg, #dc3545, #e74c3c);
    }
    
    .toast.info {
      border-left: 4px solid #bb86fc;
      background: linear-gradient(135deg, #bb86fc, #9c4dcc);
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      backdrop-filter: blur(5px);
    }
    
    .modal-content {
      background-color: #1a1a1a;
      margin: 5% auto;
      padding: 30px;
      border: 1px solid #333333;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 8px 32px rgba(0,0,0,0.9);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #333333;
    }
    
    .modal-title {
      color: #bb86fc;
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }
    
    .close {
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .close:hover {
      color: #bb86fc;
    }
    
    .help-button {
      position: absolute;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #bb86fc, #9c4dcc);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(187, 134, 252, 0.3);
      transition: all 0.3s ease;
    }
    
    .help-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(187, 134, 252, 0.4);
    }
    
    .instruction-section {
      margin-bottom: 20px;
    }
    
    .instruction-section h3 {
      color: #bb86fc;
      font-size: 1.1rem;
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .instruction-section ul {
      color: #e0e0e0;
      padding-left: 20px;
    }
    
    .instruction-section li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    
    .keyboard-shortcut {
      background-color: #333333;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.9em;
      color: #bb86fc;
    }
    
    /* Mobile adjustments for modal */
    @media (max-width: 768px) {
      .modal-content {
        margin: 10% auto;
        padding: 20px;
        width: 95%;
      }
      
      .help-button {
        top: 10px;
        right: 10px;
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      
      .toast {
        min-width: 280px;
        margin: 0 10px;
      }
    }
  </style>
    </head>
    <body>
      <div class="main-container">
          <button id="helpBtn" class="help-button">‚ùì How to Use</button>
          <div class="header-container">
            <img src="logo.png" alt="Logo" class="logo" />
            <h1>
              <span class="mic-gradient">MIC Recruitments</span> 
              <span style="color:#bb86fc;">25-26 Application Viewer</span>
            </h1>
          </div>
          <!-- Elegant file picker: styled button + dropzone -->
          <div id="filePicker" class="mb-3" style="max-width:100%;margin:0 auto;">
            <div id="dropzone" class="d-flex align-items-center justify-content-between" style="border:2px dashed #666666;border-radius:10px;padding:12px 14px;background:#222222;"> 
              <div style="display:flex;gap:12px;align-items:center;">
                <button id="chooseFileBtn" class="btn btn-outline-primary" style="min-width:140px;">Choose file</button>
                <div id="fileName" style="color:#cccccc;word-break:break-all;">No file selected</div>
              </div>
              <div>
                <button id="clearFileBtn" class="btn btn-sm btn-light" style="display:none;">Clear</button>
              </div>
            </div>
            <input type="file" id="fileInput" accept=".xlsx,.xls" style="display:none;" />
          </div>
          <input type="text" id="searchInput" class="form-control" placeholder="üîç Search by keyword..." />

          <div class="mb-3 d-flex justify-content-center gap-2">
            <select id="filterSelect" class="form-select" style="max-width:220px;">
              <option value="all">Show All</option>
              <option value="approved">Show Approved</option>
              <option value="rejected">Show Rejected</option>
            </select>
          </div>

          <!-- Filter status text -->
          <div class="text-center mb-3">
            <span id="filterStatusText" style="color:#bb86fc;font-weight:600;font-size:1.1rem;">Showing all 0 candidates</span>
          </div>          

          <!-- Shortlist counter cards -->
          <div class="d-flex gap-3 mb-3">
            <div class="card flex-fill" style="background:linear-gradient(135deg, #28a745, #20c997);text-align:center;border:2px solid #28a745;">
              <span style="font-weight:600;color:#fff;">Shortlisted</span><br>
              <span id="shortlistedCount" style="color:#fff;font-weight:bold;font-size:1.8rem;">0</span>
            </div>
            <div class="card flex-fill" style="background:linear-gradient(135deg, #dc3545, #e74c3c);text-align:center;border:2px solid #dc3545;">
              <span style="font-weight:600;color:#fff;">Not Shortlisted</span><br>
              <span id="notShortlistedCount" style="color:#fff;font-weight:bold;font-size:1.8rem;">0</span>
            </div>
          </div>
<!-- Top navigation buttons -->
          <div class="controls d-flex justify-content-center mb-2 nav-buttons">
            <button id="prevBtnTop" class="btn btn-secondary" disabled>‚¨Ö Previous</button>
            <button id="nextBtnTop" class="btn btn-primary" disabled>Next ‚û°</button>
          </div>
          <div class="card mt-3 section-gap" id="card"></div>

            <div class="d-flex justify-content-center save-row">
              <div class="d-flex flex-column flex-md-row gap-2 align-items-center">
                <button id="saveBtn" class="btn btn-warning" style="min-width:160px;font-weight:600;">üíæ Save All Changes</button>
                <button id="downloadApprovedBtn" class="btn btn-success" style="min-width:160px;font-weight:600;">üìä Export Approved</button>
                <button id="downloadContactsBtn" class="btn btn-info" style="min-width:160px;font-weight:600;">üìß Download Contacts</button>
              </div>
            </div>

          <div class="controls d-flex justify-content-center nav-buttons">
            <button id="prevBtn" class="btn btn-secondary" disabled>‚¨Ö Previous</button>
            <button id="nextBtn" class="btn btn-primary" disabled>Next ‚û°</button>
          </div>
          <div class="footer">Made with <span style="color:#bb86fc;">‚ô•</span> for recruitment teams</div>
        </div>

        <!-- How to Use Modal -->
        <div id="helpModal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h2 class="modal-title">üìñ How to Use the Recruitment Viewer</h2>
              <button class="close" id="closeModal">&times;</button>
            </div>
            
            <div class="instruction-section">
              <h3>üóÇÔ∏è Getting Started</h3>
              <ul>
                <li><strong>Upload File:</strong> Click "Choose file" or drag & drop an Excel file (.xlsx/.xls)</li>
                <li><strong>Supported Format:</strong> Excel files with candidate information in columns</li>
                <li><strong>Automatic Detection:</strong> The app automatically detects column headers</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>üîç Navigation & Search</h3>
              <ul>
                <li><strong>Browse Candidates:</strong> Use "Previous" and "Next" buttons to navigate</li>
                <li><strong>Keyboard Shortcuts:</strong> <span class="keyboard-shortcut">‚Üê</span> Previous, <span class="keyboard-shortcut">‚Üí</span> Next</li>
                <li><strong>Search:</strong> Type keywords in the search box to filter candidates</li>
                <li><strong>Clear Search:</strong> Empty search box to show all candidates again</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>‚úÖ Reviewing Candidates</h3>
              <ul>
                <li><strong>Approve:</strong> Click "Approve Candidate" to shortlist (turns green)</li>
                <li><strong>Reject:</strong> Click "Reject Candidate" to remove from shortlist (stays gray)</li>
                <li><strong>Status Tracking:</strong> See live counts of shortlisted/not shortlisted</li>
                <li><strong>Filter View:</strong> Use dropdown to show "All", "Approved", or "Rejected" only</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>üìä Filtering & Organization</h3>
              <ul>
                <li><strong>Show All:</strong> View all candidates regardless of status</li>
                <li><strong>Show Approved:</strong> View only shortlisted candidates</li>
                <li><strong>Show Rejected:</strong> View only non-shortlisted candidates</li>
                <li><strong>Status Counter:</strong> Track progress with live counters</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>üíæ Saving & Exporting Your Work</h3>
              <ul>
                <li><strong>Save All Changes:</strong> Click "üíæ Save All Changes" to download complete Excel file with all candidates</li>
                <li><strong>Export Approved Only:</strong> Click "üìä Export Approved" to download Excel file with only shortlisted candidates</li>
                <li><strong>Download Contact Cards:</strong> Click "üìß Download Contacts" to get VCard (.vcf) file of approved candidates</li>
                <li><strong>Contact Integration:</strong> VCard files can be imported into phone contacts, Outlook, Gmail, etc.</li>
                <li><strong>Preserves Data:</strong> All original data + your shortlist decisions are maintained</li>
                <li><strong>Smart Field Detection:</strong> Automatically finds Name, Email, Phone, Organization fields</li>
                <li><strong>Backup Recommended:</strong> Save regularly to avoid losing progress</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>üìß Contact Management</h3>
              <ul>
                <li><strong>VCard Format:</strong> Industry-standard contact file format (.vcf)</li>
                <li><strong>Multi-Contact File:</strong> Single file contains all approved candidates' contacts</li>
                <li><strong>Auto-Detection:</strong> Finds common field names like "Name", "Email", "Phone", "Mobile", etc.</li>
                <li><strong>Easy Import:</strong> Double-click .vcf file to add contacts to your address book</li>
                <li><strong>Cross-Platform:</strong> Works with iPhone, Android, Outlook, Gmail, Apple Contacts</li>
                <li><strong>Professional Notes:</strong> Each contact includes "Approved candidate from MIC Recruitments 25-26"</li>
              </ul>
            </div>
            
            <div class="instruction-section">
              <h3>üì± Mobile & Responsive</h3>
              <ul>
                <li><strong>Touch Friendly:</strong> Optimized for mobile and tablet use</li>
                <li><strong>Swipe Navigation:</strong> Use arrow keys or buttons to navigate</li>
                <li><strong>Responsive Design:</strong> Works on all screen sizes</li>
                <li><strong>Dark Theme:</strong> Easy on eyes during long review sessions</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container"></div>

      <script>
          let applications = [];
            let filteredIndexes = [];
            let currentIndex = 0;

          // Toast notification system
          function showToast(message, type = 'info', duration = 5000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove after duration
            setTimeout(() => {
              toast.classList.remove('show');
              setTimeout(() => {
                if (toast.parentNode) {
                  toast.parentNode.removeChild(toast);
                }
              }, 300);
            }, duration);
          }

          // Modal functionality
          const modal = document.getElementById('helpModal');
          const helpBtn = document.getElementById('helpBtn');
          const closeBtn = document.getElementById('closeModal');

          helpBtn.addEventListener('click', () => {
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
          });

          closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
          });

          // Close modal when clicking outside
          window.addEventListener('click', (e) => {
            if (e.target === modal) {
              modal.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          });

          // Close modal with Escape key
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.style.display === 'block') {
              modal.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          });

          document.getElementById('fileInput').addEventListener('change', handleFile, false);
          // New file picker UI wiring
          const chooseFileBtn = document.getElementById('chooseFileBtn');
          const dropzone = document.getElementById('dropzone');
          const fileNameEl = document.getElementById('fileName');
          const clearFileBtn = document.getElementById('clearFileBtn');

          chooseFileBtn.addEventListener('click', () => document.getElementById('fileInput').click());
          clearFileBtn.addEventListener('click', () => {
            document.getElementById('fileInput').value = '';
            fileNameEl.textContent = 'No file selected';
            clearFileBtn.style.display = 'none';
            applications = [];
            filteredIndexes = [];
            document.getElementById('card').innerHTML = '';
            updateShortlistCounter();
          });

          // Drag and drop
          dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.style.borderColor = '#bb86fc'; });
          dropzone.addEventListener('dragleave', () => { dropzone.style.borderColor = '#666666'; });
          dropzone.addEventListener('drop', (e) => {
            e.preventDefault(); dropzone.style.borderColor = '#666666';
            const file = e.dataTransfer.files[0];
            if (file) {
              const input = document.getElementById('fileInput');
              const dt = new DataTransfer();
              dt.items.add(file);
              input.files = dt.files;
              handleFile({ target: input });
              fileNameEl.textContent = file.name;
              clearFileBtn.style.display = 'inline-block';
            }
          });
          document.getElementById('nextBtn').addEventListener('click', () => showCandidate(currentIndex + 1));
          document.getElementById('prevBtn').addEventListener('click', () => showCandidate(currentIndex - 1));
          document.getElementById('nextBtnTop').addEventListener('click', () => showCandidate(currentIndex + 1));
          document.getElementById('prevBtnTop').addEventListener('click', () => showCandidate(currentIndex - 1));
          document.getElementById('searchInput').addEventListener('input', handleSearch);
          document.addEventListener('keydown', handleArrowKeys);
          document.getElementById('filterSelect').addEventListener('change', handleFilter);
          document.getElementById('saveBtn').addEventListener('click', function() {
            if (applications.length === 0) {
              showToast('‚ö†Ô∏è No data to save. Please load a file first.', 'error');
              return;
            }
            const ws = XLSX.utils.json_to_sheet(applications);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
            XLSX.writeFile(wb, 'updated_candidates.xlsx');
            showToast('üíæ File saved successfully as "updated_candidates.xlsx"', 'success');
          });

          // Download approved candidates only
          document.getElementById('downloadApprovedBtn').addEventListener('click', function() {
            const approvedCandidates = applications.filter(app => app['shortlisted'] === 'TRUE');
            if (approvedCandidates.length === 0) {
              showToast('‚ö†Ô∏è No approved candidates to export. Please approve some candidates first.', 'error');
              return;
            }
            const ws = XLSX.utils.json_to_sheet(approvedCandidates);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Approved Candidates');
            XLSX.writeFile(wb, 'approved_candidates.xlsx');
            showToast(`üìä Exported ${approvedCandidates.length} approved candidates successfully!`, 'success');
          });

          // Download VCard contacts
          document.getElementById('downloadContactsBtn').addEventListener('click', function() {
            const approvedCandidates = applications.filter(app => app['shortlisted'] === 'TRUE');
            if (approvedCandidates.length === 0) {
              showToast('‚ö†Ô∏è No approved candidates to export contacts. Please approve some candidates first.', 'error');
              return;
            }
            downloadVCardContacts(approvedCandidates);
            showToast(`üìß Downloaded contact cards for ${approvedCandidates.length} approved candidates!`, 'success');
          });

          // VCard generation function
          function downloadVCardContacts(candidates) {
            let vCardContent = '';
            
            candidates.forEach((candidate, index) => {
              // Try to find common field names for contact info
              const name = candidate.Name || candidate.name || candidate['Full Name'] || candidate['Candidate Name'] || `Candidate ${index + 1}`;
              const email = candidate.Email || candidate.email || candidate['Email Address'] || candidate['Email ID'] || '';
              const phone = candidate.Phone || candidate.phone || candidate['Mobile'] || candidate['Contact'] || candidate['Phone Number'] || '';
              const organization = candidate.Organization || candidate.organization || candidate.Company || candidate.company || '';
              
              // Generate VCard for each candidate
              vCardContent += `BEGIN:VCARD\n`;
              vCardContent += `VERSION:3.0\n`;
              vCardContent += `FN:${name}\n`;
              vCardContent += `N:${name};;;;\n`;
              
              if (email) {
                vCardContent += `EMAIL:${email}\n`;
              }
              
              if (phone) {
                vCardContent += `TEL:${phone}\n`;
              }
              
              if (organization) {
                vCardContent += `ORG:${organization}\n`;
              }
              
              vCardContent += `NOTE:Approved candidate from MIC Recruitments 25-26\n`;
              vCardContent += `END:VCARD\n\n`;
            });
            
            // Create and download the VCard file
            const blob = new Blob([vCardContent], { type: 'text/vcard;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'approved_candidates_contacts.vcf';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
          }

          function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const sheetName = workbook.SheetNames[0];
              const sheet = workbook.Sheets[sheetName];
              const json = XLSX.utils.sheet_to_json(sheet);

              // Ensure 'shortlisted' field exists and is FALSE by default
              applications = json.map(app => {
                if (!('shortlisted' in app)) app['shortlisted'] = 'FALSE';
                return app;
              });
                applyFilter();
                
                // Show success toast
                showToast(`üìÅ File loaded successfully! Found ${applications.length} candidates`, 'success');
                
              // update file name display
              const fileInput = document.getElementById('fileInput');
              const fileNameEl = document.getElementById('fileName');
              const clearFileBtn = document.getElementById('clearFileBtn');
              if (fileInput.files[0]) {
                fileNameEl.textContent = fileInput.files[0].name;
                clearFileBtn.style.display = 'inline-block';
              }
            };
            reader.readAsArrayBuffer(file);
          }

          function showCandidate(index) {
          if (filteredIndexes.length === 0) return;
          if (index < 0 || index >= filteredIndexes.length) return;

          currentIndex = index;
          const appIndex = filteredIndexes[currentIndex];
          const card = document.getElementById('card');
          card.innerHTML = '';

          const candidate = applications[appIndex];
            for (const key in candidate) {
              const wrapper = document.createElement('div');
              wrapper.className = 'mb-3';

              const label = document.createElement('label');
              label.className = 'form-label';
              label.textContent = key;

              const textarea = document.createElement('textarea');
              textarea.className = 'form-control';
              textarea.rows = 2;
              textarea.readOnly = true;
              textarea.value = candidate[key];

              // Add a subtle highlight for important fields
              if (key.toLowerCase().includes('name') || key.toLowerCase().includes('email')) {
                textarea.style.background = 'linear-gradient(90deg,#bb86fc22,#232526)';
                textarea.style.fontWeight = 'bold';
              }

              // Highlight shortlisted field
              if (key.toLowerCase() === 'shortlisted') {
                textarea.style.background = candidate[key] === 'TRUE' ? 'linear-gradient(90deg,#bb86fc88,#232526)' : 'linear-gradient(90deg,#232526,#bb86fc22)';
                textarea.style.color = candidate[key] === 'TRUE' ? '#fff' : '#e0e0e0';
                textarea.style.fontWeight = 'bold';
              }

              wrapper.appendChild(label);
              wrapper.appendChild(textarea);
              card.appendChild(wrapper);
            }

              // Approve/Reject button group
              const btnGroup = document.createElement('div');
              btnGroup.className = 'd-flex gap-2 mb-2';

              const approveBtn = document.createElement('button');
              approveBtn.className = 'btn btn-success flex-fill';
              approveBtn.textContent = candidate['shortlisted'] === 'TRUE' ? 'Shortlisted' : 'Approve Candidate';
              approveBtn.disabled = candidate['shortlisted'] === 'TRUE';
              approveBtn.onclick = function() {
                candidate['shortlisted'] = 'TRUE';
                showToast('‚úÖ Candidate approved and shortlisted!', 'success');
                applyFilter(appIndex);
              };
              btnGroup.appendChild(approveBtn);

              const rejectBtn = document.createElement('button');
              rejectBtn.className = 'btn btn-danger flex-fill';
              rejectBtn.textContent = 'Reject Candidate';
              rejectBtn.disabled = candidate['shortlisted'] !== 'TRUE';
              rejectBtn.onclick = function() {
                candidate['shortlisted'] = 'FALSE';
                showToast('‚ùå Candidate rejected and removed from shortlist', 'error');
                applyFilter(appIndex);
              };
              btnGroup.appendChild(rejectBtn);

              card.appendChild(btnGroup);

            document.getElementById('prevBtn').disabled = (currentIndex === 0);
            document.getElementById('nextBtn').disabled = (currentIndex === filteredIndexes.length - 1);
            document.getElementById('prevBtnTop').disabled = (currentIndex === 0);
            document.getElementById('nextBtnTop').disabled = (currentIndex === filteredIndexes.length - 1);
            updateShortlistCounter();
          }

          function handleSearch() {
              const query = document.getElementById('searchInput').value.toLowerCase();
              if (!query) {
                applyFilter();
                return;
              }
              // Filter indexes by search
              filteredIndexes = filteredIndexes.filter(idx => {
                const app = applications[idx];
                return Object.values(app).some(val => String(val).toLowerCase().includes(query));
              });
              currentIndex = 0;
              showCandidate(currentIndex);
          }

          function handleArrowKeys(e) {
              if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
              if (e.key === 'ArrowLeft') {
                showCandidate(currentIndex - 1);
              } else if (e.key === 'ArrowRight') {
                showCandidate(currentIndex + 1);
              }
          }

          function updateShortlistCounter() {
            const shortlisted = applications.filter(app => app['shortlisted'] === 'TRUE').length;
            const notShortlisted = applications.filter(app => app['shortlisted'] !== 'TRUE').length;
            document.getElementById('shortlistedCount').textContent = shortlisted;
            document.getElementById('notShortlistedCount').textContent = notShortlisted;
            
            // Update filter status text
            updateFilterStatusText();
          }

          function handleFilter() {
            const filter = document.getElementById('filterSelect').value;
            const filterMessages = {
              'all': 'üìã Showing all candidates',
              'approved': '‚úÖ Showing only approved candidates',
              'rejected': '‚ùå Showing only rejected candidates'
            };
            
            if (filterMessages[filter]) {
              showToast(filterMessages[filter], 'info');
            }
            
            applyFilter();
          }

          function applyFilter(jumpToIndex) {
            const filter = document.getElementById('filterSelect').value;
            if (filter === 'all') {
              filteredIndexes = applications.map((_, idx) => idx);
            } else if (filter === 'approved') {
              filteredIndexes = applications.map((app, idx) => app['shortlisted'] === 'TRUE' ? idx : null).filter(idx => idx !== null);
            } else if (filter === 'rejected') {
              filteredIndexes = applications.map((app, idx) => app['shortlisted'] !== 'TRUE' ? idx : null).filter(idx => idx !== null);
            }
            // Reset search filter
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query) {
              filteredIndexes = filteredIndexes.filter(idx => {
                const app = applications[idx];
                return Object.values(app).some(val => String(val).toLowerCase().includes(query));
              });
            }
            // Jump to current candidate if possible
            if (filteredIndexes.length === 0) {
              document.getElementById('card').innerHTML = '<div class="text-center text-muted">No candidates found.</div>';
              updateShortlistCounter();
              return;
            }
            if (jumpToIndex !== undefined) {
              // If candidate was just approved/rejected, jump to their new index
              const idx = filteredIndexes.indexOf(jumpToIndex);
              currentIndex = idx !== -1 ? idx : 0;
            } else {
              currentIndex = 0;
            }
            showCandidate(currentIndex);
          }

          function updateFilterStatusText() {
            const filter = document.getElementById('filterSelect').value;
            const total = filteredIndexes.length;
            const statusText = document.getElementById('filterStatusText');
            
            if (filter === 'all') {
              statusText.textContent = `Showing all ${total} candidates`;
            } else if (filter === 'approved') {
              statusText.textContent = `Showing all ${total} shortlisted candidates`;
            } else if (filter === 'rejected') {
              statusText.textContent = `Showing all ${total} not shortlisted candidates`;
            }
          }

        </script>
    </body>
